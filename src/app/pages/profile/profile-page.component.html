<div class="profile-container fade-in">
  <!-- Encabezado -->
  <div class="profile-header card">
    <div class="profile-info">
      <img src="https://ui-avatars.com/api/?name={{ userData?.nombre }}" alt="Avatar" class="avatar" />
      <div>
        <h2>{{ userData?.nombre || 'Usuario' }}</h2>
        <p class="muted">{{ userEmail }}</p>
      </div>
    </div>
    <button class="logout-button" (click)="logout()">Cerrar sesión</button>
  </div>

  <!-- Información editable -->
  <div class="card profile-section">
    <h3>✏️ Información personal</h3>
    <div class="field-row">
      <label>Nombre</label>
      <div *ngIf="!editing['nombre']">
        {{ userData?.nombre }}
        <button (click)="enableEdit('nombre')">Editar</button>
      </div>
      <div *ngIf="editing['nombre']">
        <input [(ngModel)]="userData.nombre" />
        <button (click)="updateField('nombre')">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Contraseña -->
  <div class="card profile-section">
    <h3>🔐 Seguridad</h3>
    <button (click)="resetPassword()">Enviar correo para cambiar contraseña</button>
  </div>

  <!-- Estadísticas -->
  <div class="card profile-section" *ngIf="metrics">
    <h3>📊 Progreso de hábitos</h3>
    <ul class="stats">
      <li><strong>Total:</strong> {{ metrics.totalHabits }}</li>
      <li><strong>Completados:</strong> {{ metrics.completed }}</li>
      <li><strong>En proceso:</strong> {{ metrics.inProgress }}</li>
      <li><strong>Fallidos:</strong> {{ metrics.failed }}</li>
      <li><strong>Completado:</strong> {{ metrics.completionRate | percent:'1.0-2' }}</li>
    </ul>
    <div style="max-width: 400px; margin: 20px auto;">
      <canvas baseChart [data]="chartData" [type]="chartType" [legend]="true"></canvas>
    </div>
  </div>

  <!-- Volver -->
  <div class="section">
    <button (click)="goHome()">🏠 Volver al tablero</button>
  </div>
</div>
